define flow clickhouse
flow
    use troy::connectors;
    use troy::pipelines;


    # sink only connector
    define connector clickhouse from clickhouse
    with
        config = {
            "url": "localhost:12345",
            "table": "people",
            "columns": [
                {
                    "name": "name",
                    "type": "utf8"
                },
                {
                    "name": "birthday",
                    "type": "datetime",
                    "default": "1970-01-01"
                }
            ]
        }
    end;

    # event format

    # ["John Doe", "1970-01-01"]
    # {
    #     "birthday": "1970-01-01",
    #     "name": "John Doe",
    # }
    # {}
    # ["John Doe"]
    # null

    create pipeline main from pipelines::passthrough;
    create connector console from connectors::console;

    connect /connector/console/out to /pipeline/main/in;
    connect /pipeline/main to /connector/clickhouse/in;
    

end;

deploy flow clickhouse;
