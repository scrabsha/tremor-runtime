define flow clickhouse
flow
    use troy::connectors;
    use troy::pipelines;

    define connector stdin from stdio
    with
        codec = "json"
    end;


    # sink only connector
    define connector clickhouse from clickhouse
    with
        config = {
            "url": "localhost",
            "database": "tremor_testing",


            "table": "people",
            "columns": [
                {
                    "name": "age",
                    "type": "UInt8",
                },
            ]
        }
    end;

    # event format

    # ["John Doe", "1970-01-01"]
    # {
    #     "birthday": "1970-01-01",
    #     "name": "John Doe",
    # }
    # {}
    # ["John Doe"]
    # null

    create pipeline main from pipelines::passthrough;

    create connector stdin;
    create connector clickhouse;

    connect /connector/stdin/out to /pipeline/main/in;
    connect /pipeline/main to /connector/clickhouse/in;
    

end;

deploy flow clickhouse;
